#:import FadeTransition kivy.uix.screenmanager.FadeTransition

ScreenManager:
    id: screen_manager
    transition: FadeTransition()
    
    MenuScreen:
        id: menu_screen
        name: 'MenuScreen'
        manager: 'screen_manager'

    HoughParametersScreen:
        id: hough_parameters_screen
        name: 'HoughParametersScreen'
        manager: 'screen_manager'

    DetectionVisualisationScreen:
        id: detection_visualisation_screen
        name: 'DetectionVisualisationScreen'
        manager: 'screen_manager'

    SizeEstimationTestingScreen:
        id: size_estimation_testing_screen
        name: 'SizeEstimationTestingScreen'
        manager: 'screen_manager'

<MenuScreen>:
    FloatLayout:
        Label:
            text: 'Prototype app'
            font_size: 50
            size_hint: 0.3,0.15
            pos_hint: {"center_x":0.5, "center_y":0.7}

        BoxLayout:
            orientation: 'vertical'
            size_hint: 0.25,0.2
            pos_hint: {'center_x':0.5, 'center_y':0.5}
        
            Button:
                text: 'Detection visualisation'
                font_size: 25
                on_release: app.root.current = 'DetectionVisualisationScreen'

            Button:
                text: 'Hough parameters tuning'
                font_size: 25
                on_release: app.root.current = 'HoughParametersScreen'

            Button:
                text: 'Size estimation testing'
                font_size: 25
                on_release: app.root.current = 'SizeEstimationTestingScreen'

<DetectionVisualisationScreen>
    # overall distinction between menu and left side
    BoxLayout:
        orientation: 'horizontal'

        # separating upper and lower part of the data
        BoxLayout:
            size_hint: (1, 1)
            orientation: 'vertical'

            # separating tracking image from the info in the right
            BoxLayout:
                size_hint: (1, 1)
                orientation: 'horizontal'
                Image:
                    id: upper_frame_image
                    size_hint: (0.5, 1)
                    allow_stretch: True
                # data info box
                BoxLayout:
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    id: upper_box
                    size_hint: (0.5, 1)
                    orientation: 'horizontal'
                    BoxLayout:
                        id: upper_box_images
                        size_hint: (0.4, 1)
                        orientation: 'vertical'
                        Image:
                            id: upper_box_images_top
                            size_hint: (1, 0.7)
                            allow_stretch: True
                        Label:
                            id: upper_box_images_middle
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Image:
                            id: upper_box_images_bottom
                            size_hint: (1, 0.3)
                            allow_stretch: True
                    BoxLayout:
                        id: upper_box_data
                        size_hint: (0.7, 1)
                        orientation: 'vertical'
                        Label:
                            font_size: 18
                            text: "------------------------ Camera A ------------------------"
                            size_hint: (1, 0.2)
                        Label:
                            id: upper_box_data_pcd_ellipse_axes
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_rim_ellipse_axes
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_ratio_of_main_axes
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_rim_estimation_inch
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            font_size: 18
                            text: "------------------------ Wheel classes ------------------------"
                            size_hint: (1, 0.2)
                        Label:
                            id: upper_box_data_pneu_class_one
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_pneu_class_two
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_pneu_class_three
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_pneu_class_four
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            font_size: 18
                            text: "------------------------ Wheel sizes [inch]------------------------"
                            size_hint: (1, 0.2)
                        Label:
                            id: upper_box_data_pneu_size_one
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_pneu_size_two
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_pneu_size_three
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: upper_box_data_pneu_size_four
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                    
            # separating tracking image from the info in the right
            BoxLayout:
                size_hint: (1, 1)
                orientation: 'horizontal'
                Image:
                    id: lower_frame_image
                    size_hint: (0.5, 1)
                    allow_stretch: True
                # data info box
                BoxLayout:
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    id: lower_box
                    size_hint: (0.5, 1)
                    orientation: 'horizontal'
                    BoxLayout:
                        id: lower_box_images
                        size_hint: (0.4, 1)
                        orientation: 'vertical'
                        Image:
                            id: lower_box_images_top
                            size_hint: (1, 0.7)
                            allow_stretch: True
                        Label:
                            id: lower_box_images_middle
                            size_hint: (1, 0.1)
                            text: ""
                        Image:
                            id: lower_box_images_bottom
                            size_hint: (1, 0.3)
                            allow_stretch: True
                    BoxLayout:
                        id: lower_box_data
                        size_hint: (0.7, 1)
                        orientation: 'vertical'
                        Label:
                            font_size: 18
                            text: "------------------------ Camera B ------------------------"
                            size_hint: (1, 0.2)
                        Label:
                            id: lower_box_data_pcd_ellipse_axes
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: lower_box_data_rim_ellipse_axes
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: lower_box_data_ratio_of_main_axes
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            id: lower_box_data_rim_estimation_inch
                            font_size: 16
                            text: ""
                            size_hint: (1, 0.1)
                        Label:
                            text: ""
                            size_hint: (1, 0.8)

        BoxLayout:
            size_hint: (None, 1)
            width: 200
            orientation: 'vertical'

            Label:
                font_size: 25
                text: 'Detection viz'

            Label:
                id: video_description_label
                text: 'Video: '
            BoxLayout:
                orientation: 'horizontal'
                Button:
                    id: video_previous_button
                    text: '<'
                    on_press: root.previous_video()
                Button:
                    id: video_next_button
                    text: '>'
                    on_press: root.next_video()

            Label:
                id: frame_description_label
                text: 'Frame: '
            BoxLayout:
                orientation: 'horizontal'
                Button:
                    id: frame_previous_button
                    text: '<'
                    on_press: root.previous_frame()
                Button:
                    id: frame_next_button
                    text: '>'
                    on_press: root.next_frame()
            BoxLayout:
                orientation: 'horizontal'
                Button:
                    id: frame_animation_previous_button
                    text: '<<'
                    on_press: root.animate_frames_backward()
                Button:
                    id: frame_animation_pause_button
                    text: '||'    
                    on_press: root.animate_frames_pause()
                Button:
                    id: frame_animation_next_button
                    text: '>>'
                    on_press: root.animate_frames_forward()
            
            # Button:
            #     id: toggle_gold_button
            #     text: 'Disable Gold labels'
            #     on_press: root.toggle_gold()

            # Button:
            #     id: toggle_yolo_button
            #     text: 'Disable YOLO'
            #     on_press: root.toggle_yolo()

            Button:
                id: toggle_hough_button
                text: 'Enable Hough'
                on_press: root.toggle_hough()

            Label:
                id: pipeline_time_label
                text: ''

            Button:
                text: 'Back to Menu'
                on_release: app.root.current = 'MenuScreen'
            

<HoughParametersScreen>:
    BoxLayout:
        orientation: 'horizontal'

        BoxLayout:
            size_hint: (1, 1)
            orientation: 'vertical'
            Image:
                id: frame_image
                size_hint: (1, 1)
                allow_stretch: True

        BoxLayout:
            size_hint: (None, 1)
            width: 200
            orientation: 'vertical'

            Label:
                font_size: 25
                text: 'Hough tuning'

            # Label:
            #     id: video_description_label
            #     text: 'Video: '
            # BoxLayout:
            #     orientation: 'horizontal'
            #     Button:
            #         id: video_previous_button
            #         text: '<'
            #     Button:
            #         id: video_next_button
            #         text: '>'

            Label:
                id: frame_description_label
                text: 'Frame: '
            BoxLayout:
                orientation: 'horizontal'
                Button:
                    id: frame_previous_button
                    text: '<'
                    on_press: root.previous_frame()
                Button:
                    id: frame_next_button
                    text: '>'
                    on_press: root.next_frame()
            # BoxLayout:
            #     orientation: 'horizontal'
            #     Button:
            #         id: frame_animation_previous_button
            #         text: '<<'
            #         on_press: root.animate_frames_backward()
            #     Button:
            #         id: frame_animation_pause_button
            #         text: '||'    
            #         on_press: root.animate_frames_pause()
            #     Button:
            #         id: frame_animation_next_button
            #         text: '>>'
            #         on_press: root.animate_frames_forward()

            Label:
                text: 'Pipeline:'

            Button:
                text: 'Downscaled view'
                on_press: root.change_image_mode("downscaled")
            Label:
                id: downscale_slider_label
                text: 'Downscale: '
            Slider:
                id: downscale_slider_slider
                min: 1
                max: 100
                value: 40
                step: 1
                on_value: root.downscale()

            Button:
                text: 'Gray view'
                on_press: root.change_image_mode("gray")

            Button:
                text: 'Blur view'
                on_press: root.change_image_mode("blur")
            Label:
                id: blur_slider_label
                text: 'Blur: '
            Slider:
                id: blur_slider_slider
                min: 1
                max: 10
                value: 2
                step: 1
                on_value: root.blur()

            # Button:
            #     text: 'Canny view'
            #     on_press: root.change_image_mode("canny")
            # Label:
            #     id: canny_slider_1_label
            #     text: 'Canny 1 param:'
            # Slider:
            #     id: canny_slider_1_slider
            #     min: 1
            #     max: 1000
            #     value: 150
            #     step: 1
            #     on_value: root.canny()
            # Label:
            #     id: canny_slider_2_label
            #     text: 'Canny 2 param:'
            # Slider:
            #     id: canny_slider_2_slider
            #     min: 1
            #     max: 1000
            #     value: 250
            #     step: 1
            #     on_value: root.canny()

            Button:
                text: 'Hough view'
                on_press: root.change_image_mode("hough")
            Label:
                id: hough_dp_label
                text: 'Dp: '
            Slider:
                id: hough_dp_slider
                min: 1
                max: 20
                value: 1
                step: 1
                on_value: root.hough()
            Label:
                id: hough_mindist_label
                text: 'MinDist: '
            Slider:
                id: hough_mindist_slider
                min: 1
                max: 150
                value: 120
                step: 1
                on_value: root.hough()
            Label:
                id: hough_param1_label
                text: 'Param1: '
            Slider:
                id: hough_param1_slider
                min: 1
                max: 400
                value: 205
                step: 1
                on_value: root.hough()
            Label:
                id: hough_param2_label
                text: 'Param2: '
            Slider:
                id: hough_param2_slider
                min: 1
                max: 100
                value: 50
                step: 1
                on_value: root.hough()
            Label:
                id: hough_minradius_label
                text: 'MinRadius: '
            Slider:
                id: hough_minradius_slider
                min: 1
                max: 300
                value: 70
                step: 1
                on_value: root.hough()
            Label:
                id: hough_maxradius_label
                text: 'MaxRadius: '
            Slider:
                id: hough_maxradius_slider
                min: 1
                max: 500
                value: 130
                step: 1
                on_value: root.hough()
            
            # Button:
            #     id: toggle_gold_button_hough
            #     text: 'Toggle gold wheel bb'
            #     on_press: root.toggle_gold_hough()

            Button:
                text: 'Back to Menu'
                on_release: app.root.current = 'MenuScreen'

<SizeEstimationTestingScreen>:
    BoxLayout:
        orientation: 'horizontal'

        BoxLayout:
            size_hint: (1, 1)
            orientation: 'vertical'
            Image:
                id: frame_image
                size_hint: (1, 1)
                allow_stretch: True

        BoxLayout:
            size_hint: (None, 1)
            width: 200
            orientation: 'vertical'

            Label:
                font_size: 25
                text: 'Size estimation'

            # Label:
            #     id: video_description_label
            #     text: 'Video: '
            # BoxLayout:
            #     orientation: 'horizontal'
            #     Button:
            #         id: video_previous_button
            #         text: '<'
            #     Button:
            #         id: video_next_button
            #         text: '>'

            Label:
                id: frame_description_label
                text: 'Frame: '
            BoxLayout:
                orientation: 'horizontal'
                Button:
                    id: frame_previous_button
                    text: '<'
                    on_press: root.previous_frame()
                Button:
                    id: frame_next_button
                    text: '>'
                    on_press: root.next_frame()
            BoxLayout:
                orientation: 'horizontal'
                Button:
                    id: frame_animation_previous_button
                    text: '<<'
                    on_press: root.animate_frames_backward()
                Button:
                    id: frame_animation_pause_button
                    text: '||'    
                    on_press: root.animate_frames_pause()
                Button:
                    id: frame_animation_next_button
                    text: '>>'
                    on_press: root.animate_frames_forward()

            # Label:
            #     text: 'Pipeline:'

            # Button:
            #     text: 'Downscaled view'
            #     on_press: root.change_image_mode("downscaled")
            # Label:
            #     id: downscale_slider_label
            #     text: 'Downscale: '
            # Slider:
            #     id: downscale_slider_slider
            #     min: 1
            #     max: 100
            #     value: 40
            #     step: 1
            #     on_value: root.downscale()

            # Button:
            #     text: 'Gray view'
            #     on_press: root.change_image_mode("gray")

            # Button:
            #     text: 'Blur view'
            #     on_press: root.change_image_mode("blur")
            # Label:
            #     id: blur_slider_label
            #     text: 'Blur: '
            # Slider:
            #     id: blur_slider_slider
            #     min: 1
            #     max: 10
            #     value: 2
            #     step: 1
            #     on_value: root.blur()

            # Button:
            #     text: 'Canny view'
            #     on_press: root.change_image_mode("canny")
            # Label:
            #     id: canny_slider_1_label
            #     text: 'Canny 1 param:'
            # Slider:
            #     id: canny_slider_1_slider
            #     min: 1
            #     max: 1000
            #     value: 150
            #     step: 1
            #     on_value: root.canny()
            # Label:
            #     id: canny_slider_2_label
            #     text: 'Canny 2 param:'
            # Slider:
            #     id: canny_slider_2_slider
            #     min: 1
            #     max: 1000
            #     value: 250
            #     step: 1
            #     on_value: root.canny()

            # Button:
            #     text: 'Hough view'
            #     on_press: root.change_image_mode("hough")
            # Label:
            #     id: hough_dp_label
            #     text: 'Dp: '
            # Slider:
            #     id: hough_dp_slider
            #     min: 1
            #     max: 20
            #     value: 1
            #     step: 1
            #     on_value: root.hough()
            # Label:
            #     id: hough_mindist_label
            #     text: 'MinDist: '
            # Slider:
            #     id: hough_mindist_slider
            #     min: 1
            #     max: 100
            #     value: 120
            #     step: 1
            #     on_value: root.hough()
            # Label:
            #     id: hough_param1_label
            #     text: 'Param1: '
            # Slider:
            #     id: hough_param1_slider
            #     min: 1
            #     max: 300
            #     value: 205
            #     step: 1
            #     on_value: root.hough()
            # Label:
            #     id: hough_param2_label
            #     text: 'Param2: '
            # Slider:
            #     id: hough_param2_slider
            #     min: 1
            #     max: 100
            #     value: 50
            #     step: 1
            #     on_value: root.hough()
            # Label:
            #     id: hough_minradius_label
            #     text: 'MinRadius: '
            # Slider:
            #     id: hough_minradius_slider
            #     min: 1
            #     max: 100
            #     value: 70
            #     step: 1
            #     on_value: root.hough()
            # Label:
            #     id: hough_maxradius_label
            #     text: 'MaxRadius: '
            # Slider:
            #     id: hough_maxradius_slider
            #     min: 1
            #     max: 100
            #     value: 130
            #     step: 1
            #     on_value: root.hough()
            Label:
                id: textx
                text: '_____'
            Label:
                id: textxx
                text: '_____'
            Label:
                id: textxxx
                text: '_____'
            Label:
                size_hint: (1, 0.6)
                id: textxxxx
            Button:
                text: 'Back to Menu'
                on_release: app.root.current = 'MenuScreen'